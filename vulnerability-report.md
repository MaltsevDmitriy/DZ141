# Vulnerabilities Report

Reviewer: Justin Lange

## Reviewing nVisium Task Manager

### XSS

#### Exposure
The site is vulnerable to cross-site scripting. By changing the
username, I was able to inject arbitrary HTML (and, through the
&lt;script&gt; tag, JS) into the page I was viewing. To test this, I set my
username to &lt;script&gt;alert('woops!')&lt;/script&gt; and noticed that whenever
I refreshed the page, a dialog with "woops!" in it appeared.

#### Repair
In base_backend.html on line 58, the template marks user.username as
safe. By removing this, the problem is fixed. A number of other parts
of templates are innapropriately marked as safe, such as in
search.html, task.html, etc. For example, `{{ username|safe }}` should
simply be `{{ username }}`. The safe modifier should only be used when
one is absolutely sure the HTML being inserted is safe (e.g., if it
does not originate from user input at all).


### Insecure DOR

#### Exposure
By visiting `/taskManager/dashboard/` when one is logged out, all of the
tasks may be viewed. Furthermore, one can visit any of the tasks
regardless of authentication. (e.g.,
`http://127.0.0.1:8000/taskManager/2/12/`).

#### Repair
Whenever a user requests a page created by another user, the
authentication status of the user should be checked. This site is
insecure both in allowing logged out users to see all tasks, and in
allowing users to see each other's tasks. `/taskManager/dashboard/`
should be decorated with `login_required` in Django, and additionally
any tasks should check that the task is owned by the user. For
example, in views.py, `@login_required` should be added above line 629
to prevent the issue of seeing anyone's tasks when logged out.


### Broken Authentication

#### Exposure
The registration page allows the user to set any attribute on the User
model, including is_staff. With is_staff, the user can log into the
administration page. Although the ability to do so is not immediately
visible, POSTing to the registration form allows for setting any of
the attributes. Worse yet, the HTML exposes which attributes can be
set in a comment block.

#### Repair
The UserForm in forms.py uses the exclude attribute poorly. In order
to fix this bug, `is_staff` may be added to the UserForm, along with
the other exposed attributes. However, it would be far easier to use
the `fields` value on the UserForm, and only select those which are
intended to be accepted from the user.


### Injection

#### Exposure
SQL injection is possible through the file name field on the project
file upload page. For example, by setting the file name to
`quux',(<some sql>), 0); --`, <some sql> gets executed inline,
allowing access to passwords, etc.

#### Repair
The filename gets inserted into SQL code through basic Python
formatting rather than through SQL escaping. By default Django handles
this on its own. On line 183 in views.py the `execute` method on the
database connection cursor gets used with a regular Python
string. This is unnecessary; one can create a model by accessing the
Django model object for file uploads with the appropriate fields
(`models.File(<etc>)`). Rarely if ever is raw SQL actually required in
a Django application, so its use (especially alongside normal Python
string formatting!) is a red flag.
