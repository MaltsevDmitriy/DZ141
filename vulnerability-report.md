Reviewing nVisium Task Manager

Reviewer: Jared Scarr
Date: 4-25-2016

Vulnerability 1

Exposure

The file upload field is being executed directly to the database. Giving the user
access also to the file name without using Django's form validations leaves it
open to scripting attacks if the file the project belongs to and the attack project
id match.

Repair

view.py in the taskManager app contained the vulnerability. I was able to fix
the the code with the following adjustment(s):

views.py

 file = File(name = name, path = upload_path, project = proj)
 file.save()

 replaces:

 curs = connection.cursor()
curs.execute(
    "insert into taskManager_file ('name','path','project_id') 
     values ('%s','%s',%s)" %
     (name, upload_path, project_id))

Vulnerability 2

Exposure

The registration view is vulnerable because it includes all fields. Including 
the ability to be a super user. A little change in the html and the user may
manually enable this prior to registration to give themselves superuser status.
You can see the cookie right there. It can be read my anybody.

Repair

forms.py and settings.py in the taskManager app contained the vulnerability. I was able to fix
the the code with the following adjustment(s):

forms.py

on line 75 
exclude = ['groups', 'user_permissions', 'last_login', 'date_joined', 'is_active']

should be changed to:
include = ['username', 'first_name', 'last_name', 'password']

settings.py

The secret key must be set to an environmental variable. Debug needs to be set
to false. 

Line 84 should be removed and a cookie session engine configured. Add 'django.contrib.sessions' to your INSTALLED_APPS.

SESSION_ENGINE=("django.contrib.sessions.backends.signed_cookies")
SESSION_COOKIE_HTTPONLY=True

Vulnerablility 3

Exposure

The user update user profile template is vulnerable to XXS.

Repair

templates/profile.html

needs a csrf token ({% csrf token %}) added to the form. Really any form that
is going to take user input.

Vulnerability 4

Exposure

You can see all task no matter if they belong to the user signed in or not. 
You can type an id into the request and if it exists you have access.

Repair

user_form = UserForm(request.POST, instance=request.user)


