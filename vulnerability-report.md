#### Reviewer: Sera Smith

#### Date: Feb. 4, 2017

### Find Vulnerabilities in nVisium Task Manager:

## Vulnerability 1 - SQL injection

This vulnerability allowed access and exploitation of the database, where it is possible to retrieve data or drop tables, due to raw SQL commands being used. 
The hashed database admin password was also accessible.

Running the SQL command: ```INSERT INTO taskManager_file ('name','path','project_id') VALUES ('testPic',(SELECT password FROM auth_user WHERE username='admin'),8);--,...``` which allows the upload of the sensitive file as a "photo".


##Repair

To fix this vulnerability, ORM should be used instead of direct SQL and methods like curs.execute().

Specifically: 
``` 
file = File(name=name, path=upload_path, project=proj)
file.save()
```

## Vulnerability 2 - Broken Authentication

User can gain Superuser status upon registration, meaning any user can have admin rights. This can allow any user to steal sensitive data such as other users' email, and even delete entire accounts. 

##Repair

Forms.py should have _include_ or _fields_ list instead of _excludes_, listing what the user must have instead of remembering all the fields to exclude. _Excludes_ is much easier to miss an important field that could expose a security risk. 

Specifically:

Instead of : 
```
exclude = ['groups', 'user_permissions', 'last_login', 'date_joined', 'is_active']
```

Could be:
```
fields = ['username', 'first_name', 'last_name', 'password', 'email']
```

which would make admin rights only available to Superusers.


## Vulnerability 3  - Cross Site Scripting (XSS)

Templates displaying the username as 'safe' allowed access of a username and able to execute the username as code in a different language or even HTML.

## Repair
Change template to not use the 'safe' option.

Instead of: 
```
{{ user.username|safe }}
```

Use:
```
{{ user.username }}
```

## Vulnerability 4 - Insecure Direct Object Reference

Insecure DOR. Any user can access the /admin page along with other pages that should require authentication/authorization. By directly inputting a profile path (including profile number) into the URL, a user is able to access, edit/upload a photo to, and even delete any profile. 
Vulnerability extends past a specific profile. The projects can have files uploaded, along with the ability to view, edit, and create tasks and projects.  

##Repair 

In views.py, add decorator: 
``` 
@permission_required 
``` 
to each view that needs to be secured. 


## Vulnerability 5 -Security Misconfiguration

The debug variable should not be set to True.

## Repair

Set debug to false

Instead of: 
```
DEBUG = True
TEMPLATE_DEBUG = True
```

Instead, in setting.py:
```
DEBUG = False
TEMPLATE_DEBUG = False
ALLOWED_HOSTS = ['localhost']
```

## Vulnerability 6 - Sensitive Data Exposure

MD5PasswordHasher being used to hash password.

## Repair


Instead, views.py: 
```
PASSWORD_HASHERS = ['django.contrib.auth.hashers.MD5PasswordHasher']
```

Use a much more secure hasher:
```
PASSWORD_HASHERS = ['django.contrib.auth.hashers.BCryptPasswordHasher']
```

## Vulnerability 7 - Function Level Access Control

The manage_groups is not secure. POST request handling is not confirming that the user making such request has the appropriate rights. method in views.py is not correctly secured. Initially, a check is done to see if the user is authenticated but no further check is done to see if the user has permissions to post.

## Repair

Add authorization check prior to allowing POST request. Specifically, add: 

```
if user.is_authenticated() and user.has_perm('can_change_group') 
```

check to the views.py. 


## Vulnerability 8 - Cross-site Request Forgery (CSRF)

Csrf_exempty decorators. With this decorator, imcoming requests do not get checked for its csrf tokens, and consequentially
when this decorator is used, django will not check for the csrf token for incoming requests where a user browser can be hijackedd.


## Repair

Remove csrf_exempt decorators.

