## Vulnerability Report
### *Reviewer 1:* Daniel Zwelling
### *Reviewer 2:* Selena Flannery
### *Date:* April 22 2016

## Reviewing nVisium Task Manager

## Vulnerability

First of all, debug is set to True. So, that's kind of a problem.

### *Injection*

We found SQL injection in the upload
We typed this...
     `test_pic', (select password from auth_user where username = admin), 9);--`
And got this error `no such column: admin` which means we succsesfully interacted with the database.
This is what the code originally said:
   `curs = connection.cursor()`
            `curs.execute(`
                `"insert into taskManager_file ('name','path','project_id') values ('%s','%s',%s)" %`
                `(name, upload_path, project_id))`
This is what we changed it to:
    `    file = File(`
                `name=name,`
                `path=upload_path,`
                `project=proj`
            `)`

### *Broken Auth*

This is the problem:
    `class UserForm(forms.ModelForm):`
    `""" User registration form """`
    `class Meta:`
        `model = User`
        `exclude = ['groups', 'user_permissions', 'last_login', 'date_joined', 'is_active']`

We changed the `exclude` line to this:
    `fields = ['username', 'password', 'email', 'first_name', 'last_name']`


### *XSS*

This is the problem:
    `<span class="username"><i class="fa fa-user fa-fw"></i> {{ user.username|safe }}</span>`
This is how we fixed it:
    `<span class="username"><i class="fa fa-user fa-fw"></i> {{ user.username }}</span>`
    We removed the `|safe`
### *Insecure Direct Object References*

This is the problem:
    ```def task_delete(request, project_id, task_id):
    proj = Project.objects.get(pk=project_id)
    task = Task.objects.get(pk=task_id)
    if proj is not None:
        if task is not None and task.project == proj:
            task.delete()

    return redirect('/taskManager/' + project_id + '/')```
This is the solution:
    `if request.user in task.users_assigned.all():`
    This line needs to appear after the task has been created so that we can
    ensure that you can only delete your tasks.
FYI: The views file is littered with this vulnerability. We only fixed the one example so far.


### *Security Misconfiguration*

We found out pretty quickly that DEBUG was set to True by forcing a 404
for example, we typed in this url `http://localhost:8000/taskManager/somethingsocooltothrow404`
The solution is to set DEBUG to False, but, we're running it locally so obviously, DEBUG would be True

### *Sensitive Data Exposure*

The hashing algorithm is weak. We fixed the SQL injection so a user can't access the
admin hashed password.

The solution would be to use a stronger hashing algorithm.

### *Access*

This is the problem:
    `if user.is_authenticated()`
This is how we fixed it:
    `if user.is_authenticated() and user.has_perm():`

We added the call to `.has_perm` into the POST request block

### *CSRF*

The problem is all of the `@csrf_exempt` decorators

We copied the edit profile form, made an html file out of it with substituted values,
opened the file in a new tab while logged in as another user and submitted.

To remedy the problem, we removed the csrf decorators

### *Components*

The problem is:
    The current version of Django

### *Redirects*

This is the problem:
    ```def logout_view(request):
    logout(request)
    return redirect(request.GET.get('redirect', '/taskManager/'))```

We changed it to this:
    ```def logout_view(request):
    logout(request)
    return redirect('/taskManager/')```

We took out the GET request since user input is not necesary.








