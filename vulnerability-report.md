#Vulnerability Report
Reviewer 1: Ted Callahan
Reviewer 2: Rick Valenzuela

Date: February 1st, 2017

##Reviewing nVisium Task Manager


##Vulnerability A1: Injection
###Exposure
We found an instance of an SQL Injection vulnerability in the file upload form (line 183 in views.py).

By exploiting this problem, we are able to perform SQL injection and retrieve data or drop tables from the database.

###Repair
Rather than use a formatted SQL command with input from the form, the site should use the Django ORM to create a File object instance for addition to the databse.

Problem Code (Lines 182 - 185, views.py):
```
curs = connection.cursor()
curs.execute(
    "insert into taskManager_file ('name','path','project_id') values ('%s','%s',%s)" %
    (name, upload_path, project_id))
```

###Solution:
```
file = File(
name = name,
path = upload_path,
project = proj)

file.save()
```

##Vulnerability A2: Broken Authentication and Sesson Management
###Exposure
Various upload functions call the store_uploaded_file() funtion at line 24 of misc.py.  This function passes a given filename to the os.system function giving a user the potential to pass in shell commands as a filename.

###Repair
Do not allow the user to pass in a filename.  Give the file a randomly generated name; there is no reason for a user to give a file a name for use in the application.

Instead, create a File instance and save the file instance in the database.  The user can give the File object a name, thus preventing any need for calling os.system or any commands that rely on command line commands.

###Solution:
Comment out or remove lines 14-17 of templates/taskManager/upload.html:
```
<div class="form-group">
    <label>File Name</label>
    <input id="id_name" maxlength="300" name="name" type="text" />
</div>
```

##Vulnerability A3: Cross-Site Scripting
###Exposure
The User registration form (class UserForm) as defined in forms.py (lines 71 - 75) is insecure because it does not explicitly state which fields are allowed.  A user could add fields for other attributes of the Django user model (in this instance, is_superuser and is_staff).

By exploiting this problem, we are able to add form fields to the User registration form to edit user attributes on the Django model.

###Repair
Instead of a partial exclude list of fields, use the fields attribute in the Meta class to explicitly declare which fields should be in the form.

Problem Code (line 75 in forms.py):
```
exclude = ['groups', 'user_permissions', 'last_login', 'date_joined', 'is_active']
```

###Solution:
```
fields = ['username', 'email', 'first_name', 'last_name', 'password']
```

##Vulnerability A4: Insecure Direct Object References
###Exposure
Users are not authenticated for pages that should require it; therefore, a user's data can be accessed, deleted or changed by others simply if another user feeds in the proper parameters to hit that page. Several views in views.py for a CRUD operation lacked an authentication check. These are the view functions that begin on lines: 112, 170, 221, 243, 277, 304, 329, 358, 520, 541, 567 and 719.

By exploiting this problem, we were able to modify, delete and create tasks and files on another user's account.

###Repair
At the start of each view function, add an authentication check.

###Solution
add this to each function:
```
user = request.user
if user.is_authenticated():
```
